<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.commerce.model.mapper.CommerceMapper">
	
	<select id="getStoreList" parameterType="map" resultType="storeDto">
		select bizesId,bizesNm,brchNm,indsLclsCd,indsLclsNm,indsMclsCd,indsMclsNm,indsSclsCd,indsSclsNm,ksicCd,ksicNm,ctprvnCd,ctprvnNm,signguCd,signguNm,adongCd,adongNm,ldongCd,ldongNm,lnoCd,plotSctCd,plotSctNm,lnoMnno,lnoSlno,lnoAdr,rdnmCd,rdnm,bldMnno,bldSlno,bldMngNo,bldNm,rdnmAdr,oldZipcd,newZipcd,dongNo,flrNo,hoNo,lon,lat
			from stores
			<where>
				and lat between #{latStart} and #{latEnd}
				and lon between #{lonStart} and #{lonEnd}
				
				<if test="indsLclsCd != null and indsLclsCd != ''">
					and indsLclsCd = #{indsLclsCd}
				</if>
			</where>
	</select>
	
	<select id="getDongsByCoord" parameterType="map" resultType="dongCodeLatlngDto">
		select dongcode, addressCount, sidoName, gugunName, dongName, lat, lon
			from dongcodeLatlng
			<where>
				and lat between #{latStart} and #{latEnd}
				and lon between #{lonStart} and #{lonEnd}
			</where>
	</select>
	
	<select id="getEstate" parameterType="string" resultType="estateDto">
		select id, dealClass,dealAmount,floor ,area ,description,joinYear ,joinMonth ,joinDay ,sido ,gugun,dong ,jibun,dongCode,lat ,lon 
		from estates
		where id = #{id};
	</select>
	
	<select id="getEstateList" parameterType="map" resultType="estateDto">
		select id, dealClass,dealAmount,floor ,area ,description,joinYear ,joinMonth ,joinDay ,sido ,gugun,dong ,jibun,dongCode,lat ,lon 
		from estates
			<where>
				and lat between #{latStart} and #{latEnd}
				and lon between #{lonStart} and #{lonEnd}
			</where>	
	</select>
	
	<select id="getDealCostAvgByDong" parameterType="map" resultType="comPropDto">
		select id, dealAmount, buildingArea, buildingUse, buildYear, dealYear, plottage, dong, sigungu, landUse, dealMonth, buildingType, dealDay, regionalCode 
		from comProp
		where regionalCode=substr(#{dongCode},1,5) and dong=#{dong}
	</select>
	
	<select id="getDealCostAvgByDongList" parameterType="list" resultType="dealCostAvgDto">
		select avg(dealAmount) as "dealAmountAvg" , avg(dealAmount/buildingArea) as "dealAmountPerArea", concat(regionalCode,dong) as "regionCodeAndDong"
		from comProp
		where concat(regionalCode,dong) in 
		<foreach collection="list" item="item" open="(" close=")" separator=",">
			 concat(substr(#{item.dongCode},1,5),#{item.dongName})
		</foreach> 	
		group by concat(regionalCode,dong);
	</select>

</mapper>